# Name of your application
service: poker

# Name of the container image
image: poker

# Deploy to these servers
servers:
  web:
    - 63.182.34.164

# Enable SSL via Let's Encrypt
proxy:
  ssl: true
  host: plutonpoker.com
  app_port: 3000
  forward_headers: true

# AWS ECR Registry
registry:
  server: 225656797743.dkr.ecr.eu-central-1.amazonaws.com
  username: AWS
  password:
    - KAMAL_REGISTRY_PASSWORD

# Environment variables for the container
env:
  clear:
    DOMAIN: plutonpoker.com
    PORT: 3000
    TRUSTED_PROXY_CIDRS: 127.0.0.1/32,::1/128,172.16.0.0/12,10.0.0.0/8,192.168.0.0/16
    # Note: HTTPS_KEY and HTTPS_CERT are NOT set, so backend runs in HTTP mode

# Build for ARM64 (Graviton instances)
builder:
  arch: arm64

# Volume mounts for persistent data
volumes:
  - /opt/poker/data:/app/data

# SSH configuration
ssh:
  user: ubuntu
  keys:
    - ~/.ssh/poker_ed25519
